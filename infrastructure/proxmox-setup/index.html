
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://192.168.1.2:8000/infrastructure/proxmox-setup/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Proxmox Setup & ZFS RAID Configuration - Homelab Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proxmox-setup-zfs-raid-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Homelab Docs" class="md-header__button md-logo" aria-label="Homelab Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Homelab Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Proxmox Setup &amp; ZFS RAID Configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Homelab Docs" class="md-nav__button md-logo" aria-label="Homelab Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Homelab Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxmox_setup.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proxmox Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/pihole/config_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pi-hole
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/grafana_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grafana Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-summary" class="md-nav__link">
    <span class="md-ellipsis">
      System Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-flash-proxmox-iso-to-usb" class="md-nav__link">
    <span class="md-ellipsis">
      1. Flash Proxmox ISO to USB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-configure-bios-and-storage-controller" class="md-nav__link">
    <span class="md-ellipsis">
      2. Configure BIOS and Storage Controller
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zfs-raid-1-setup" class="md-nav__link">
    <span class="md-ellipsis">
      ZFS RAID 1 Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZFS RAID 1 Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-created-zfs-mirror-pool" class="md-nav__link">
    <span class="md-ellipsis">
      1. Created ZFS Mirror Pool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zfs-automatic-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      ZFS Automatic Snapshots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZFS Automatic Snapshots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-used" class="md-nav__link">
    <span class="md-ellipsis">
      Tool Used
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-retention-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Default Retention Policy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="proxmox-setup-zfs-raid-configuration">Proxmox Setup &amp; ZFS RAID Configuration</h1>
<h2 id="overview">Overview</h2>
<p>This document outlines the installation and configuration of <code>pve1</code>, the primary Proxmox node in my homelab. It includes the setup of Proxmox VE 8.4.1 using a macOS-flashed USB, configuration of the Dell H730 Mini controller in HBA (IT) mode, and the deployment of a ZFS mirror (RAID 1) across two 2TB SAS drives. ZFS automatic snapshots have been enabled to provide versioned backups and rollback points.</p>
<p>This setup prioritizes data integrity, service reliability, and future scalability. All steps are documented to ensure clarity.</p>
<hr />
<h2 id="system-summary">System Summary</h2>
<ul>
<li><strong>Node:</strong> pve1</li>
<li><strong>Hardware:</strong> Dell PowerEdge R430</li>
<li><strong>Drives:</strong> 2 × 2TB SAS</li>
<li><strong>Proxmox Version:</strong> 8.4.1</li>
<li><strong>Storage Type:</strong> ZFS Mirror (RAID 1)</li>
</ul>
<hr />
<h2 id="step-by-step-installation">Step-by-Step Installation</h2>
<h3 id="1-flash-proxmox-iso-to-usb">1. Flash Proxmox ISO to USB</h3>
<p>Used macOS terminal tools instead of GUI software:</p>
<pre><code class="language-bash"># Convert the ISO to a raw disk image format (.dmg) suitable for writing to USB
hdiutil convert -format UDRW -o proxmox-ve_8.4-1.dmg ~/Downloads/proxmox-ve_8.4-1.iso

# List all disks to identify the USB drive (e.g., /dev/disk2)
diskutil list

# Unmount the USB drive so it can be written to directly
diskutil unmountDisk /dev/disk2

# Write the .dmg image to the USB drive using raw access (note the 'r' in rdisk2 for faster write)
sudo dd if=proxmox-ve_8.4-1.dmg of=/dev/rdisk2 bs=1m
</code></pre>
<p><strong>Why:</strong> Using the macOS CLI gives more control over the flashing process, avoids GUI tools, and allows installing Proxmox directly from a clean bootable USB. Writing the ISO to USB ensures the OS lives on its own device, keeping the primary drives available for dedicated ZFS storage.</p>
<h3 id="2-configure-bios-and-storage-controller">2. Configure BIOS and Storage Controller</h3>
<ul>
<li>Set USB as the primary boot device to ensure the Proxmox installer loads first.</li>
<li>Configured the H730 Mini RAID controller into <strong>HBA (IT) mode</strong> to allow ZFS direct access to raw disks.</li>
<li>Verified both 2TB drives were exposed individually (non-RAID) to the Proxmox installer.</li>
</ul>
<p><strong>Why:</strong> ZFS requires direct access to physical disks for redundancy and integrity features. HBA mode bypasses the RAID logic, making the drives visible as raw block devices to the OS without removing the controller.</p>
<hr />
<h2 id="zfs-raid-1-setup">ZFS RAID 1 Setup</h2>
<h3 id="1-created-zfs-mirror-pool">1. Created ZFS Mirror Pool</h3>
<p>Used the Proxmox web UI during installation:
- Selected <strong>ZFS RAID 1 (mirror)</strong> using <code>/dev/sda</code> and <code>/dev/sdb</code>
- Accepted the <strong>default pool name</strong>: <code>rpool</code></p>
<p><strong>ZFS provides:</strong>
- <strong>Built-in redundancy</strong> via mirroring (RAID 1)
- <strong>Data integrity</strong> through checksumming and self-healing
- <strong>Efficient snapshots</strong> for backups and rollback
- <strong>SMART integration</strong> to monitor drive health and predict failure (<code>zpool status</code> and <code>smartctl</code> both supported natively)</p>
<p><strong>Note to self (future plan):</strong><br />
Once the remaining 6 drives are installed, plan to:
- Expand to a <strong>RAID-Z2 or multiple mirror vdevs</strong>
- Create a <strong>separate storage pool</strong> for high-capacity or tiered storage use
- Consider setting up <strong>ZFS alerts</strong> and monitoring via Grafana or Prometheus</p>
<hr />
<h2 id="zfs-automatic-snapshots">ZFS Automatic Snapshots</h2>
<h3 id="tool-used">Tool Used</h3>
<p>Installed <code>zfs-auto-snapshot</code>, which adds automated, scheduled snapshots using system cron jobs.</p>
<pre><code class="language-bash">apt update
apt install zfs-auto-snapshot -y
</code></pre>
<h3 id="default-retention-policy">Default Retention Policy</h3>
<p>Once installed, snapshots are created and rotated automatically:
- Hourly: 24 retained
- Daily: 7 retained
- Weekly: 4 retained
- Monthly: 12 retained</p>
<p>Snapshots are stored within the same dataset and do not consume extra space unless data changes (copy-on-write).</p>
<p><strong>Verify Snapshots</strong>
To view existing snapshots:</p>
<pre><code class="language-bash">zfs list -t snapshot
</code></pre>
<p><strong>Why It Matters</strong>
- Provides automatic rollback points for VMs and datasets
- Enables rapid recovery from misconfiguration, corruption, or deletion
- Integrates with ZFS-native features like rollback and replication
- Supports SMART-based storage and future offsite backup plans</p>
<p><strong>Note to Self</strong>
- Plan to integrate snapshot monitoring with Grafana or Prometheus
- Future: Automate off-node snapshot syncing for cold storage redundancy</p>
<p><strong>Optional:</strong> Exclude specific datasets with:</p>
<pre><code class="language-bash">zfs set com.sun:auto-snapshot=false rpool/data/iso-store
</code></pre>
<hr />
<h2 id="notes">Notes</h2>
<ul>
<li>Proxmox 8.4.1 was installed via a bootable USB created using macOS CLI tools (<code>dd</code>, <code>hdiutil</code>) for maximum control and precision.</li>
<li>The Dell H730 Mini controller was left installed but switched to <strong>HBA (IT) mode</strong>, allowing Proxmox/ZFS direct access to raw disks.</li>
<li>No hardware RAID is used — <strong>ZFS software RAID 1 (mirror)</strong> provides redundancy, integrity checking, and snapshot capability.</li>
<li>Automatic snapshots (<code>zfs-auto-snapshot</code>) are scheduled hourly, daily, weekly, and monthly using cron, enabling lightweight rollback and recovery.</li>
<li><strong>SMART monitoring</strong> is natively supported in ZFS; future plans include logging and alerting via Grafana/Prometheus stack.</li>
<li>ZFS snapshots are copy-on-write and live within the same datasets, requiring minimal space unless data changes.</li>
<li>All configurations were documented from the beginning to ensure traceability, reproducibility, and showcase-level professionalism.</li>
<li>Plans to expand storage to <strong>RAID-Z2 or multiple vdev mirrors</strong> with six additional drives for higher capacity and resilience.</li>
<li>Future snapshot syncing and backup strategy will include <strong>off-node replication</strong> or <strong>cold storage</strong>, improving disaster recovery posture.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>